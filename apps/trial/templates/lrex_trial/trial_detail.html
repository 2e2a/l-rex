{% extends "lrex_dashboard/results_base.html" %}
{% load contrib_tags %}

{% block content %}
<table class="table bg-white">
    <thead>
    <tr>
        <th>Materials</th>
        <th>Item</th>
        {% if study.pseudo_randomize_question_order %}<th>Question order</th>{% endif %}
        <th>Content</th>
        {% if study.has_question_with_random_scale %}
        <th>Random scale</th>
        {% endif %}
        {% for question in trial.questionnaire.study.questions.all %}
        <th>Rating</th>
        {% if question.has_rating_comment %}
        <th>Comment</th>
        {% endif %}
        {% endfor %}
    </tr>
    </thead>
    <tbody>
    {% for q_item, ratings in trial.questionnaire_item_ratings %}
    <tr>
        <td>{{ q_item.item.materials }}</td>
        <td>
            {{ q_item.item }}
        </td>
        {% if study.pseudo_randomize_question_order %}
        <td>{{ q_item.question_order_user }}</td>
        {% endif %}
        <td>
            {% if q_item.item.textitem %}
            {{ q_item.item.textitem.text|linebreaks }}
            {% elif q_item.item.markdownitem %}
            {{ q_item.item.markdownitem.text|markdownify }}
            {% else %}
            {% for item_url in q_item.item.audiolinkitem.urls_list %}
            <div>
                <audio controls="controls">
                    <source src="{{ item_url }}">
                    Your browser does not support the <code>audio</code> element.
                </audio>
            </div>
            {% endfor %}
            {% endif %}
        </td>
        {% if study.has_question_with_random_scale %}
        <td>
            {% for question_property in q_item.question_properties.all %}
            Q{{ forloop.counter }}: "{{ question_property.question_scale_user }}"<br>
            {% endfor %}
        </td>
        {% endif %}
        {% for rating in ratings %}
        <td>
            {{ rating.scale_value.label }}
        </td>
        {% if rating.question_object.has_rating_comment %}
        <td>
            {% if rating.comment %}
            "{{ rating.comment }}"
            {% endif %}
        </td>
        {% endif %}
        {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
