{% extends "lrex_dashboard/results_base.html" %}

{% block actions %}
<div class="dropdown">
  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="dropdownAggregate" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
      Aggregated by: {{ aggregate_by_label }}
  </button>
  <div class="dropdown-menu" aria-labelledby="dropdownAggregate">
      <a class="dropdown-item" href="?aggregate_by=subject,item">subject+item</a>
      <a class="dropdown-item" href="?aggregate_by=subject">subject</a>
      <a class="dropdown-item" href="?aggregate_by=item">item</a>
  </div>
</div>
{% endblock %}

{% block content %}
<table class="table bg-white">
<thead>
{% if study.is_multi_question %}
<tr>
    <th scope="col"></th>
    <th scope="col"></th>
    <th scope="col"></th>
    {% for question in study.questions.all %}
    <th scope="col" colspan="{{ question.scalevalues.count }}">Question {{ forloop.counter }}</th>
    {% endfor %}
</tr>
{% endif %}
<tr>
    {% if 'subject' not in aggregate_by %}<th scope="col">Subject</th>{% endif %}
    {% if 'item' not in aggregate_by %}<th scope="col">Item</th>{% endif %}
    {% if 'condition' not in aggregate_by %}<th scope="col">Condition</th>{% endif %}
    <th scope="col">N</th>
    {% for question in study.questions.all %}
        {% for scale_value in question.scale_values.all %}
        <th scope="col" class="table-primary">{{ scale_value.label }}</th>
        {% endfor %}
    {% endfor %}
</tr>
</thead>
<tbody>
{% for row in results %}
<tr>
    {% if 'subject' not in aggregate_by %}<td>{{ row.subject }}</td>{% endif %}
    {% if 'item' not in aggregate_by %}<td>{{ row.item }}</td>{% endif %}
    {% if 'condition' not in aggregate_by %}<td>{{ row.condition }}</td>{% endif %}
    <td>{{ row.rating_count }}</td>
    {% for rating in row.scale_ratings_flat %}
    <td class="table-primary">{{ rating|floatformat:2 }}</td>
    {% endfor %}
</tr>
{% endfor %}
</tbody>
</table>
{% include 'lrex_contrib/pagination.html' with page_obj=results %}
{% endblock %}
