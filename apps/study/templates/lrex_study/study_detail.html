{% extends "lrex_home/base.html" %}
{% load contrib_tags %}
{% load static %}

{# Design: next-steps, status + results #}
{% block content %}
{% if not study.is_archived %}
<div class="card">
    <div class="card-body">
        <h2 class="card-title">Status</h2>
        <div class="row">
            <div class="col-md-6 ">
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Current status:
                    </div>
                    <div class="col-sm-6">
                        <span class="badge badge-primary">{{ study.status.name }}</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Created:
                    </div>
                    <div class="col-sm-6">
                        {{ study.created_date|date:"SHORT_DATE_FORMAT" }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Test your study:
                    </div>
                    <div class="col-sm-6">
                        {% if allow_publish %}
                        <a href="{% url 'trial-intro' study.slug %}?test=True" target="_blank">Link for testing&nearr;</a>
                        {% else %}
                        <a class="card-link text-muted">Link for testing</a>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    {% if study.creator == request.user %}
                    <div class="col-sm-6 text-secondary">
                        Study shared with:
                    </div>
                    <div class="col-sm-6 col-md-6">
                        {{ study.shared_with|default_if_none:"--" }}
                    </div>
                    {% else %}
                    <div class="col-sm-6 text-secondary">
                        Study shared by:
                    </div>
                    <div class="col-sm-6">
                        {{ study.creator }}
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Make your study available:
                    </div>
                    <div class="col-sm-6">
                        {% if study.is_published %}
                        <a href="{% url 'trial-intro' study.slug %}" target="_blank">Link for participants&nearr;</a>
                        {% else %}
                        <a class="card-link text-muted">Link for participants</a>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Password:
                    </div>
                    <div class="col-sm-6 col-md-6">
                        {{ study.password|default_if_none:"--" }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 text-secondary">
                        Trials completed:
                    </div>
                    <div class="col-sm-6">
                        {{ trial_count_finished }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="card mt-4">
    <div class="card-body">
        <h2 class="card-title">To do</h2>
        {% if not study.is_active %}
        <div class="row">
            <div class="col-md-6 ">
                <em>Required:</em>
                <ul>
                    {% for next_step_html in next_steps_html %}
                    <li>{{ next_step_html }}</li>
                    {% empty %}
                    <li>Nothing to do</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-6">
                <em>Optional:</em>
                <ul>
                    {% for optional_step_html in optional_steps_html %}
                    <li>{{ optional_step_html }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% else %}
        <em>Your study is active.</em>
        {% endif %}
    </div>
</div>
{% else %}
<div class="p-4 border bg-white">
    Study has been archived. <a href="{% url 'study-archive-restore' study.slug %}">Restore the study?</a>
</div>
{% endif %}
{% endblock %}
