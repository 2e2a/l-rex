{% extends "lrex_home/base.html" %}
{% load contrib_tags %}
{% load progress_tags %}
{% load static %}

{% block content %}
<div class="row small text-secondary justify-content-center mb-2">
    <form class="form-inline" method="post">
        {% csrf_token %}
        {% if study.is_published %}
        <button type="submit" name="action" value="unpublish"
                class="btn btn-warning btn-sm mx-1">
            Unpublish
        </button>
        {% else %}
        <button type="submit" name="action" value="publish"
                class="btn btn-success btn-sm mx-1 {% if not study|is_progress_std_questionnares_generated_reached %} disabled {% endif %}">
            Publish
        </button>
        {% endif %}
    </form>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card my-2 {% if study|is_progress_std_created %} border-primary shadow{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Tasks</h2>
                    <span><img src="{% static 'icons/comment.svg' %} " width="20"></span>
                </div>
                <p class="card-text">
                    Specify the task and task instructions.
                </p>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Questions:
                    </div>
                    <div class="col-sm-7">

                        {% for question in study.questions %}
                        {{ question }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                        --
                        {% endfor %}

                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Instructions:
                    </div>
                    <div class="col-sm-7">
                        {{ study.instructions|preview:"40" }}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Outro:
                    </div>
                    <div class="col-sm-7">
                        {{ study.outro|preview:"40" }}
                    </div>
                </div>
                <hr>
                <a  class="card-link" href="{% url 'study-questions' study.slug %}">Questions</a>
                <a  class="card-link" href="{% url 'study-instructions' study.slug %}">Instructions</a>
            </div>
        </div>

        <div class="card my-2 {% if study|is_progress_std_question_created_reached and not study|is_progress_std_exp_completed_reached %} border-primary shadow{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Experiments</h2>
                    <span><img src="{% static 'icons/flask.svg' %} " width="20"></span>
                </div>
                <p class="card-text">
                    Add experiments (including fillers). Items of all experiments will be intermixed with each other within the same questionnaire.
                </p>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Experiments ready:
                    </div>
                    <div class="col-sm-7">

                        {% for experiment in experiments_ready %}
                        {{ experiment }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                        --
                        {% endfor %}

                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Experiments in draft:
                    </div>
                    <div class="col-sm-7">

                        {% for experiment in experiments_draft %}
                        {{ experiment }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                        --
                        {% endfor %}

                    </div>
                </div>
                <hr>
                {% if study|is_progress_std_question_created_reached %}
                <a  class="card-link" href="{% url 'experiments' study.slug %}">Experiments</a>
                {% else %}
                <a  class="card-link disabled text-muted">Create/edit experiments</a>
                {% endif %}
            </div>
        </div>

        <div class="card my-2 {% if study|is_progress_std_exp_completed %} border-primary shadow{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Questionnaires</h2>
                    <span><img src="{% static 'icons/clipboard-list.svg' %} " width="20"></span>
                </div>
                <p class="card-text">
                    Generate questionnaires. A questionnaire is the ordered list of stimuli that an individual participant will see.
                </p>
                <div class="row small text-secondary">
                    <div class="col-sm-3">
                        Questionnaires created:
                    </div>
                    <div class="col-sm-7">
                        {{ study.questionnaire_set.count }}
                    </div>
                </div>
                <hr>
                {% if study|is_progress_std_exp_completed_reached  %}
                <a  class="card-link" href="{% url 'questionnaires' study.slug %}">Generate questionnaires</a>
                {% else %}
                <a  class="card-link text-muted">Questionnaires</a>
                {% endif %}
            </div>
        </div>

        <div class="card my-2">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Results</h2>
                    <span><img src="{% static 'icons/poll.svg' %} " width="20"></span>
                </div>
                <p class="card-text">
                    View a summary of the current results or the completed individual questionnaires.
                </p>
                <div class="row small text-secondary small text-secondary">
                    <div class="col-sm-3">
                        Trials taken:
                    </div>
                    <div class="col-sm-7">
                        {{ trial_count }}
                    </div>
                </div>
                <hr>
                {% if study|is_progress_std_questionnares_generated_reached %}
                <a  class="card-link" href="{{ study.results_url }}">Summary of the results</a>
                <a  class="card-link" href="{% url 'trials' study.slug %}">Individual user trials</a>
                {% else %}
                <a class="card-link text-muted">Summary of the results</a>
                <a class="card-link text-muted">Individual user trials</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card my-2">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Status</h2>
                    <span><img src="{% static 'icons/lightbulb.svg' %} " width="20"></span>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-5">
                        Current status:
                    </div>
                    <div class="col-sm-5">
                        <span class="badge badge-primary">{{ study.status.name }}</span>
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-5">
                        Participate:
                    </div>
                    <div class="col-sm-5">
                        {% if study.is_published %}
                        <a href="{% url 'trial-create' study.slug %}">Participant link</a>
                        {% else %}
                        <a class="card-link text-muted">Participant link</a>
                        {% endif %}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-5">
                        Password:
                    </div>
                    <div class="col-sm-5">
                        {{ study.password }}
                    </div>
                </div>
            </div>
        </div>
        <div class="card  my-2">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h2 class="card-title">Settings</h2>
                    <span><img src="{% static 'icons/sliders-h.svg' %} " width="20"></span>
                </div>
                <p class="card-text">
                    Set the general properties of the study.
                </p>
                <div class="row small text-secondary">
                    <div class="col-sm-6">
                        Item Type:
                    </div>
                    <div class="col-sm-4">
                        {{ study.get_item_type_display }}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-6">
                        Participant id:
                    </div>
                    <div class="col-sm-4">
                        {{ study.require_participant_id|yesno }}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-6">
                        Participation code:
                    </div>
                    <div class="col-sm-4">
                        {{ study.generate_participation_code|yesno }}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-6">
                        End date:
                    </div>
                    <div class="col-sm-4">
                        {% if study.end_date %}
                        {{ study.end_date|date:"SHORT_DATE_FORMAT" }}
                        {% else %}
                        --
                        {% endif %}
                    </div>
                </div>
                <div class="row small text-secondary">
                    <div class="col-sm-6">
                        Trial limit:
                    </div>
                    <div class="col-sm-4">
                        {{ study.trial_limit|default:"--" }}
                    </div>
                </div>
                <div class="row small text-secondary">
                    {% if study.creator == view.request.user %}
                    <div class="col-sm-6">
                        Shared with:
                    </div>
                    <div class="col-sm-4">
                        {{ study.shared_with|default:"--" }}
                    </div>
                    {% else %}
                    <div class="col-sm-6">
                        Shared by:
                    </div>
                    <div class="col-sm-4">
                        {{ study.creator.username }}
                    </div>
                    {% endif %}
                </div>
                <hr>
                <a  class="card-link" href="{% url 'study-update' study.slug %}">Settings</a>
                <a  class="card-link" href="{% url 'study-share' study.slug %}">Share</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
